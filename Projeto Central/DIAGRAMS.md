# Diagramas Visuais - UnificaÃ§Ã£o Projeto Central

## 1ï¸âƒ£ Arquitetura Atual (Before)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        INTERNET / USERS                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                  â”‚                  â”‚
           â”‚                  â”‚                  â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
    â”‚   Central   â”‚    â”‚  Novo Pex   â”‚   â”‚   Vendas    â”‚
    â”‚   (HTML)    â”‚    â”‚  (React)    â”‚   â”‚   (HTML)    â”‚
    â”‚  :3001      â”‚    â”‚   :3000     â”‚   â”‚   :3002     â”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
           â”‚                  â”‚                  â”‚
      â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”
      â”‚Login A   â”‚      â”‚Login B   â”‚      â”‚Login C   â”‚
      â”‚3 logins  â”‚      â”‚Dispersos â”‚      â”‚Diferentesâ”‚
      â”‚diferentesâ”‚      â”‚Sem sync  â”‚      â”‚Mantidos  â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                  â”‚                  â”‚
      â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”
      â”‚Local     â”‚      â”‚Local     â”‚      â”‚Local     â”‚
      â”‚Storage A â”‚      â”‚Storage B â”‚      â”‚Storage C â”‚
      â”‚Inconsistâ”‚      â”‚Scattered â”‚      â”‚Separated â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

âŒ PROBLEMAS:
   - 3 URLs diferentes
   - 3 logins distintos
   - CÃ³digo duplicado
   - SincronizaÃ§Ã£o manual
   - 3 deploys independentes
   - ExperiÃªncia fragmentada
```

---

## 2ï¸âƒ£ Arquitetura Proposta (After)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               INTERNET / USERS (1 URL)                    â”‚
â”‚          https://projeto-central.viva.com                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  NEXT.JS APP SHELL  â”‚
        â”‚   projeto-central   â”‚
        â”‚      :3000          â”‚
        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚   â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  AuthContext     â”‚
        â”‚  (Centralizado)  â”‚
        â”‚  Token + User    â”‚
        â”‚  localStorage    â”‚
        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Shell Layout (Header + Sidebar)    â”‚
        â”‚  Componentes Globais                â”‚
        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚         â”‚         â”‚            â”‚
  â”Œâ”€â”€â–¼â”€â”€â”  â”Œâ”€â”€â–¼â”€â”€â”  â”Œâ”€â”€â”€â–¼â”€â”€â”€â”  â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”
  â”‚ PEX â”‚  â”‚Vend â”‚  â”‚ Academâ”‚  â”‚ Future â”‚
  â”‚ Mod â”‚  â”‚ Mod â”‚  â”‚ Mod   â”‚  â”‚ Mods   â”‚
  â”‚ (4) â”‚  â”‚ (3) â”‚  â”‚ (5)   â”‚  â”‚ (...) â”‚
  â””â”€â”€â”¬â”€â”€â”˜  â””â”€â”€â”¬â”€â”€â”˜  â””â”€â”€â”€â”¬â”€â”€â”€â”˜  â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚        â”‚        â”‚          â”‚
     â”‚ Lazy   â”‚ Lazy   â”‚ Lazy     â”‚ Dynamic
     â”‚ Load   â”‚ Load   â”‚ Load     â”‚ Loading
     â”‚        â”‚        â”‚          â”‚
  â”Œâ”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”
  â”‚  Central API Router & Backend       â”‚
  â”‚  /api/auth/*                        â”‚
  â”‚  /api/sheets (PEX)                  â”‚
  â”‚  /api/vendas (Vendas)               â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚                     â”‚              â”‚
  â”Œâ”€â”€â–¼â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”
  â”‚ Google  â”‚      â”‚ Google    â”‚   â”‚ External  â”‚
  â”‚ Sheets  â”‚      â”‚ Sheets    â”‚   â”‚ APIs      â”‚
  â”‚ Auth    â”‚      â”‚ Data      â”‚   â”‚ Vendas    â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

âœ… BENEFÃCIOS:
   + 1 URL Ãºnica
   + 1 login centralizado
   + CÃ³digo reutilizÃ¡vel
   + SincronizaÃ§Ã£o automÃ¡tica
   + 1 deploy por vez
   + UX unificada
   + EscalÃ¡vel para novos mÃ³dulos
```

---

## 3ï¸âƒ£ Fluxo de AutenticaÃ§Ã£o Detalhado

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. USUÃRIO ACESSA /login                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. FORM: username + password                             â”‚
â”‚    handleSubmit() â†’ login(username, password)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. POST /api/auth/login                                  â”‚
â”‚    {username, password}                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. BACKEND:                                              â”‚
â”‚    a) Fetch users from Google Sheets CSV                â”‚
â”‚    b) Validate username exists                          â”‚
â”‚    c) Validate password with bcryptjs.compare()         â”‚
â”‚    d) Generate JWT token                                â”‚
â”‚    e) Return {success, token, user}                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. FRONTEND:                                             â”‚
â”‚    a) Recebe response                                    â”‚
â”‚    b) dispatch({ type: 'LOGIN_SUCCESS', ... })         â”‚
â”‚    c) localStorage.setItem('auth_token', token)         â”‚
â”‚    d) localStorage.setItem('auth_user', JSON.str(user))â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. REDIRECIONADO PARA /dashboard/pex                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 7. SHELL RENDERIZA:                                      â”‚
â”‚    â€¢ Header (com user name)                             â”‚
â”‚    â€¢ Sidebar (com mÃ³dulos permitidos)                   â”‚
â”‚    â€¢ PexModule (conteÃºdo especÃ­fico)                    â”‚
â”‚                                                          â”‚
â”‚ useAuth() â†’ state.isAuthenticated = true                â”‚
â”‚            state.user.accessLevel = 0|1                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 8. MÃ“DULOS USAM useAuth():                               â”‚
â”‚    â€¢ filterDataByPermission(data, user)                 â”‚
â”‚    â€¢ <ProtectedRoute requiredLevel={1}>                 â”‚
â”‚    â€¢ isAuthorized(1) â†’ check access                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 4ï¸âƒ£ Roteamento de MÃ³dulos (DinÃ¢mico)

```
URL             â†’ Router Pattern              â†’ Componente
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
/login          â†’ /login.tsx                  â†’ LoginPage

/dashboard/pex  â†’ /[module]/[[...slug]].tsx   â†’ 
                    module='pex' slug=[]       â†’ PexModule
                                                 Dashboard

/pex/dashboard  â†’ /[module]/[[...slug]].tsx   â†’
                    module='pex' slug=['dashboard']
                                                 â†’ PexModule
                                                    Dashboard

/pex/ranking    â†’ /[module]/[[...slug]].tsx   â†’
                    module='pex' slug=['ranking']
                                                 â†’ PexModule
                                                    Ranking

/pex/parametros â†’ /[module]/[[...slug]].tsx   â†’
                    module='pex' slug=['parametros']
                    + <ProtectedRoute requiredLevel={1}>
                                                 â†’ PexModule
                                                    Parametros
                                                    (se level 1)

/vendas         â†’ /[module]/[[...slug]].tsx   â†’
                    module='vendas' slug=[]     â†’ VendasModule
                                                    Dashboard

/vendas/analise â†’ /[module]/[[...slug]].tsx   â†’
                    module='vendas' slug=['analise']
                                                 â†’ VendasModule
                                                    Analise

/academy/...    â†’ /[module]/[[...slug]].tsx   â†’
                    module='academy' slug=[...] â†’ AcademyModule
                                                    (futuro)

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
PadrÃ£o geral:
   /[MODULE_ID]/[PAGE]?[FILTERS]
   
   Qualquer mÃ³dulo em modules.config.ts
   Ã© automaticamente roteÃ¡vel!
```

---

## 5ï¸âƒ£ Estrutura de Estado GlobalContext

```
AuthContext (src/context/AuthContext.tsx)
â”‚
â”œâ”€â”€ state: AuthState
â”‚   â”œâ”€â”€ isAuthenticated: boolean
â”‚   â”œâ”€â”€ user: AuthUser | null
â”‚   â”‚   â”œâ”€â”€ username: string
â”‚   â”‚   â”œâ”€â”€ firstName: string
â”‚   â”‚   â”œâ”€â”€ accessLevel: 0 | 1
â”‚   â”‚   â””â”€â”€ unitNames?: string[]
â”‚   â”œâ”€â”€ token: string | null
â”‚   â”œâ”€â”€ loading: boolean
â”‚   â””â”€â”€ error: AuthError | null
â”‚       â”œâ”€â”€ code: 'INVALID_CREDENTIALS' | 'USER_NOT_FOUND' | 'UNKNOWN'
â”‚       â””â”€â”€ message: string
â”‚
â””â”€â”€ actions:
    â”œâ”€â”€ login(username, password): Promise<void>
    â”œâ”€â”€ logout(): void
    â””â”€â”€ isAuthorized(requiredLevel?: 0|1): boolean

AcessÃ­vel via:
   const { state, login, logout, isAuthorized } = useAuth()

localStorage persistence:
   auth_token: JWT string
   auth_user: JSON string {username, firstName, accessLevel, unitNames}
```

---

## 6ï¸âƒ£ Hierarquia de Componentes

```
_app.tsx
â”‚
â”œâ”€â”€ <AuthProvider>
â”‚   â”‚
â”‚   â””â”€â”€ <Component>  (page)
â”‚       â”‚
â”‚       â”œâ”€â”€ /login.tsx
â”‚       â”‚   â””â”€â”€ LoginForm
â”‚       â”‚
â”‚       â”œâ”€â”€ /[module]/[[...slug]].tsx
â”‚       â”‚   â”‚
â”‚       â”‚   â””â”€â”€ <Shell showSidebar={true}>
â”‚       â”‚       â”‚
â”‚       â”‚       â”œâ”€â”€ <Header>
â”‚       â”‚       â”‚   â”œâ”€â”€ Logo
â”‚       â”‚       â”‚   â”œâ”€â”€ User Info
â”‚       â”‚       â”‚   â””â”€â”€ Logout Button
â”‚       â”‚       â”‚
â”‚       â”‚       â”œâ”€â”€ <Sidebar>
â”‚       â”‚       â”‚   â”œâ”€â”€ Nav Item: PEX
â”‚       â”‚       â”‚   â”œâ”€â”€ Nav Item: Vendas
â”‚       â”‚       â”‚   â””â”€â”€ Nav Item: Academy (futuro)
â”‚       â”‚       â”‚
â”‚       â”‚       â””â”€â”€ <main>
â”‚       â”‚           â”‚
â”‚       â”‚           â”œâ”€â”€ <ModuleRouter>
â”‚       â”‚           â”‚   â”‚
â”‚       â”‚           â”‚   â”œâ”€â”€ PexModule
â”‚       â”‚           â”‚   â”‚   â”œâ”€â”€ DashboardPage
â”‚       â”‚           â”‚   â”‚   â”œâ”€â”€ RankingPage
â”‚       â”‚           â”‚   â”‚   â”œâ”€â”€ ResultadosPage
â”‚       â”‚           â”‚   â”‚   â””â”€â”€ ParametrosPage (ProtectedRoute level 1)
â”‚       â”‚           â”‚   â”‚
â”‚       â”‚           â”‚   â””â”€â”€ VendasModule
â”‚       â”‚           â”‚       â”œâ”€â”€ DashboardVendas
â”‚       â”‚           â”‚       â”œâ”€â”€ AnaliseFiltros
â”‚       â”‚           â”‚       â””â”€â”€ RelatorioDetalhado
â”‚       â”‚           â”‚
â”‚       â”‚           â””â”€â”€ [MÃ³dulo especÃ­fico renderizado]
â”‚       â”‚
â”‚       â””â”€â”€ /api/...
â”‚           â”œâ”€â”€ /api/auth/login.ts
â”‚           â”œâ”€â”€ /api/auth/logout.ts
â”‚           â””â”€â”€ /api/[...proxy].ts (para outras APIs)
```

---

## 7ï¸âƒ£ Estrutura de Dados: UsuÃ¡rio

```
Antes (Espalhado):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ localStorage (Central.html)  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ accessCode: "ABC123"         â”‚
â”‚ accessLevel: "1"             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ localStorage (novo_pex)      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ auth_token: "jwt_token_pex"  â”‚
â”‚ username: "joao"             â”‚
â”‚ firstName: "JoÃ£o"            â”‚
â”‚ accessLevel: "1"             â”‚
â”‚ unitNames: ["UNI-001"]       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ localStorage (Vendas.html)   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ userLogin: "vendas_user"     â”‚
â”‚ permissionLevel: "2"         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Depois (Centralizado):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ AuthContext (src/context/)         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ state.user: AuthUser               â”‚
â”‚ â”œâ”€â”€ username: "joao"               â”‚
â”‚ â”œâ”€â”€ firstName: "JoÃ£o"              â”‚
â”‚ â”œâ”€â”€ accessLevel: 0 | 1             â”‚
â”‚ â”‚  0: Franqueado (unidade Ãºnica)   â”‚
â”‚ â”‚  1: Franqueadora (todas)         â”‚
â”‚ â””â”€â”€ unitNames?: ["UNI-001"]        â”‚
â”‚                                    â”‚
â”‚ state.token: JWT                   â”‚
â”‚ state.isAuthenticated: boolean     â”‚
â”‚ state.loading: boolean             â”‚
â”‚ state.error?: AuthError            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

PersistÃªncia Ãºnica:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ localStorage                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ auth_token: JWT (24h)              â”‚
â”‚ auth_user: {                       â”‚
â”‚   username, firstName,             â”‚
â”‚   accessLevel, unitNames           â”‚
â”‚ }                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 8ï¸âƒ£ Matriz de PermissÃµes

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ accessLevel â”‚ DescriÃ§Ã£o      â”‚ Ver Dados      â”‚ Funcionalid â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 0           â”‚ Franqueado     â”‚ Sua unidade    â”‚ View/Export â”‚
â”‚             â”‚ (Franquia)     â”‚ (unitNames[])  â”‚ Not admin   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1           â”‚ Franqueadora   â”‚ Todas unidades â”‚ Full access â”‚
â”‚             â”‚ (Rede)         â”‚ (sem filtro)   â”‚ Admin       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Roteamento por PermissÃ£o:

/pex/dashboard        âœ… 0  âœ… 1  (todos)
/pex/ranking          âœ… 0  âœ… 1  (todos)
/pex/resultados       âœ… 0  âœ… 1  (todos - dados filtrados)
/pex/parametros       âŒ 0  âœ… 1  (apenas franqueadora)
/vendas               âœ… 0  âœ… 1  (todos - dados filtrados)

Exemplo de filtro:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ user.accessLevel = 0 (Franqueado)      â”‚
â”‚ user.unitNames = ["UNI-001", "UNI-002"]â”‚
â”‚                                        â”‚
â”‚ Dados disponÃ­veis:                     â”‚
â”‚ [UNI-001 data] âœ… (estÃ¡ em unitNames) â”‚
â”‚ [UNI-002 data] âœ… (estÃ¡ em unitNames) â”‚
â”‚ [UNI-003 data] âŒ (nÃ£o estÃ¡)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 9ï¸âƒ£ Timeline de ImplementaÃ§Ã£o (5 Semanas)

```
Semana 1: SETUP GLOBAL
â”œâ”€ Dia 1-2: Repo + Next.js config
â”œâ”€ Dia 3-4: AuthContext + Login
â”œâ”€ Dia 5: Shell layout
â””â”€ âœ… Milestone: Login funcionando

Semana 2-3: INTEGRAR PEX
â”œâ”€ Dia 1-2: Migrar componentes
â”œâ”€ Dia 3-4: Integrar hooks
â”œâ”€ Dia 5: Roteamento interno
â”œâ”€ Dia 6: Testes permissÃµes
â””â”€ âœ… Milestone: PEX como mÃ³dulo

Semana 3-4: CONVERTER VENDAS
â”œâ”€ Dia 1-2: AnÃ¡lise (9832 linhas!)
â”œâ”€ Dia 3-5: React components
â”œâ”€ Dia 6-7: TypeScript + hooks
â”œâ”€ Dia 8: Roteamento
â””â”€ âœ… Milestone: Vendas funcional

Semana 4-5: OTIMIZAÃ‡ÃƒO + DEPLOY
â”œâ”€ Dia 1-2: Code splitting
â”œâ”€ Dia 3: Performance audit
â”œâ”€ Dia 4: E2E tests
â”œâ”€ Dia 5: Staging
â””â”€ âœ… Milestone: LIVE em produÃ§Ã£o!

Timeline: 5 semanas (1 time de 2-3 devs)
```

---

## ğŸ”Ÿ Comparativo: Antes vs Depois

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Aspecto          â”‚ ANTES          â”‚ DEPOIS           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ URLs             â”‚ 3 diferentes   â”‚ 1 Ãºnica          â”‚
â”‚ Logins           â”‚ 3 logins       â”‚ 1 login          â”‚
â”‚ CÃ³digo Auth      â”‚ 3x duplicado   â”‚ Centralizado     â”‚
â”‚ localStorage     â”‚ Inconsistente  â”‚ Padronizado      â”‚
â”‚ Deploy           â”‚ 3x + lento     â”‚ 1x + rÃ¡pido      â”‚
â”‚ ManutenÃ§Ã£o       â”‚ DifÃ­cil (3x)   â”‚ FÃ¡cil (1x)       â”‚
â”‚ Escalabilidade   â”‚ DifÃ­cil        â”‚ PadrÃ£o simples   â”‚
â”‚ UX               â”‚ Fragmentada    â”‚ Coesiva          â”‚
â”‚ Performance      â”‚ Desotimizada   â”‚ Code splitting   â”‚
â”‚ Type Safety      â”‚ Parcial        â”‚ Strict mode      â”‚
â”‚ Custo DevOps     â”‚ Alto           â”‚ Baixo            â”‚
â”‚ Time to Market   â”‚ Lento          â”‚ RÃ¡pido           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Legenda de SÃ­mbolos

```
âœ…  = Implementado / Funcional
âŒ  = NÃ£o implementado / Acesso negado
â³  = Em progresso / Planejado
ğŸš€  = Pronto para deploy
ğŸ“¦  = MÃ³dulo / Componente
ğŸ”  = Protegido / Requer autenticaÃ§Ã£o
âš™ï¸   = ConfiguraÃ§Ã£o / Setup
ğŸ“  = DocumentaÃ§Ã£o
```

---

**PrÃ³ximo passo**: Ler `ARCHITECTURE_UNIFICATION.md` para detalhes de implementaÃ§Ã£o

